# Описание работы
Разработка и регистрация драйвера устройства

Драйвер устройства регистрирует устройство

- /dev/clkd - позволяет переводить строки из base64 в обычную строку и обратно.
Режим работы задется через параметр processing_mode.

## Цель
- Закрепить и продемонстрировать полученные на курсе знания, умения и навыки.
- Подготовить портфолио для работодателя.

## Функционал

- Образ из нашего репозитория
- Ядро из нашего репозитория собранно и оптимизированно согласно ДЗ №1
.config файл включен в репозиторий

### Драйвер устройства должен
- реализовывать операции read, write, ioctl.
- регистрироваться в файловых системах.

## Уровень сложности

- Реализация символьного устройства с базовыми операциями.
- Обработка ошибок (проверка NULL, освобождение ресурсов в exit-функциях).

## Сборка и загрузка
- Модуль ядра должен собираться через Makefile.
- В Makefile есть цели для загрузки и выгрузки модуля.
- После загрузки устройство появляется в /dev, /proc, /sys.

## Документация

В README.md описать:
- Как собрать и загрузить модуль.
- Примеры использования read, write, ioctl.
- Описание интерфейсов в /proc, /sys.

## Тестирование

Проверка работы через пользовательские приложения:
- Чтение/запись данных в устройство.
- Использование ioctl для управления параметрами.
- Визуализация данных в /proc/my_device и /sys/class/my_device.

## Форма сдачи

- Отдельный, публично доступный репозиторий
- Проект создан НЕ ОДНИМ коммитом и НЕ ОДНИМ днем
- Результат проектной работы должен соответствовать требованиям

## Темы для работы:
- Реализовать драйвер символьного устройства с функциями read, write, ioctl. 
- Зарегистрировать драйвер в файловых системах /proc, /sys, /dev. (light)

## Критерии оценки

Что мы будем оценивать:
- Модуль ядра для драйвера устройства собирается
- Модуль ядра для драйвера устройства загружается
- В "README.md" описан процесс использования драйвера (сборка, запуск и функционал)
- Драйвер устройства умеет read/write, есть интерфейсы ioctl. proc. sys. dev

## Результат оценки
- Обозначим сильные стороны
- Отметим, что можно было сделать лучше

## Компетенции

Презентация проекта
- Систематизировать информацию
- Разрабатывать презентацию
- Провести презентацию проекта

# Сборка
- Установить исходники ядра 6.1.130
- Перейти в дирректорию с Makefile
- Выполнить make module
- Для сборки тестов используем make tests

# Запуск
- Выполнить команду sudo make load
- По умолчанию устройство грузится в режиме разделяемых данных для процесса
	- Для загрузки в глобальном режиме используется команда
	``` shell
		sudo insmod clkd.ko device_mode=0
	```
- В дирректории /dev должно появится устройство /dev/clkd
- Должен появится файл /proc/clkd/reset
- Должен появится файл /sys/class/clkd/clkd/reset

# Использование
Устройство используется для кодирования и декодирования данных в формат base64.
По умолчанию устройство запускается в режиме шифрования по base64 т.е. любая строка, переданная на вход, будет закодирована в base64.
Смена режима шифрования реализована через параметр /sys/module/clkd/parameters/processing_mode или ioctl сообщение SET_MODE.

## Режимы работы
Устройство поддерживает два режима работы 

### Глобальный режим
В данном режиме драйвер используется общий глобальный буфер для записи и чтения.
Т.е. писать и читать данный можно через стандартные операции cat и echo.
Данные между записью и чтением не удаляются.

Например:
``` shell
echo -n "Hello world!" | sudo tee /dev/clkd > /dev/null
sudo cat /dev/clkd
```

Для очистки глобального буфера можно использовать команды, реализованные через procfs и sysfs.
``` shell
echo "1" > /proc/clkd/reset

echo "1" > /sys/class/clkd/clkd/reset
```

### Режим с буфером на каждое открытие устройства
В данном режиме при окрытии устройства создается буфер и ассоциируется с текущим файловым дескриптором.

Данные между разными файловыми дескрипторами не пересекаются.
Для каждого устройства можно управлять режимом шифрования/дешифрования через ioctl сообщение SET_MODE.
Пример использования можно посмотреть в `tests\device_test_app.c`